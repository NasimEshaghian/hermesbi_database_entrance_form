<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<title>مدیریت اطلاعات شرکت‌ها و نمایشگاه</title>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" />
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Source Sans 3',sans-serif;background:#f4f6f9;padding:20px}
.container{max-width:1500px;margin:auto;background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 15px 40px rgba(0,0,0,.12)}
.header{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;padding:35px;text-align:center}
.header h1{font-size:2.2em;font-weight:700}
.form-body{padding:40px}

/* Sections */
.section{
  background:#fafbff;padding:28px;border-radius:18px;margin-bottom:34px;
  box-shadow:0 6px 20px rgba(0,0,0,.06);border:1px solid #e2e8f0;
  transition:all .3s ease;
}
.section.collapsed .form-grid{display:none}
.section h3{
  margin-bottom:0;color:#1e293b;font-size:1.45em;border-bottom:none;
  padding:10px 0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;
}
.toggle-icon{
  transition:transform .3s ease;font-size:1.1em;color:#6366f1;
}
.section.collapsed .toggle-icon{transform:rotate(180deg)}

/* Grid */
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}

/* Labels */
label{display:block;margin-bottom:8px;font-weight:600;color:#1e293b;font-size:1em}

/* Chosen Dropdown */
.chosen-container{position:relative;margin-bottom:18px}
.chosen-trigger{
  width:100%;padding:12px 46px 12px 16px;border:1px solid #cbd5e1;border-radius:14px;background:#fff;
  font-size:1.02em;display:flex;flex-wrap:wrap;align-items:center;cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.08);transition:all .3s;height:auto;min-height:52px;color:#1e293b;
  gap:6px;
}
.chosen-trigger:hover{border-color:#6366f1;transform:translateY(-1px)}
.chosen-trigger.open{border-color:#6366f1;box-shadow:0 0 0 4px rgba(99,102,241,.25)}
.chosen-placeholder{color:#94a3b8;font-size:0.96em}
.chosen-arrow i{font-size:0.95em;color:#64748b;transition:transform .3s}
.chosen-trigger.open .chosen-arrow i{transform:rotate(180deg)}
.chosen-drop{
  position:absolute;top:100%;left:0;right:0;background:#fff;border:1px solid #cbd5e1;border-top:none;
  border-radius:0 0 14px 14px;max-height:320px;overflow-y:auto;z-index:9999;display:none;
  box-shadow:0 20px 40px rgba(0,0,0,.18);margin-top:5px
}
.chosen-search{padding:12px;border-bottom:1px solid #e2e8f0}
.chosen-search input{width:100%;padding:10px;border:1px solid #e2e8f0;border-radius:10px;outline:none;font-size:0.96em;color:#1e293b}
.active-result{padding:13px 18px;cursor:pointer;transition:all .2s;font-size:0.98em;color:#1e293b !important}
.active-result:hover{background:#eef2ff !important;color:#6366f1 !important;font-weight:600}
.active-result.selected{background:#6366f1 !important;color:#fff !important;font-weight:700}

/* Chips */
.chosen-trigger .chosen-single-value {
  display: block !important;
  margin: 6px 12px 6px 36px;
  padding: 8px 12px;
  background: #6366f1;
  color: #fff;
  border-radius: 10px;
  font-size: 0.92em;
  font-weight: 600;
  line-height: 1.5;
  position: relative;
  width: calc(100% - 48px);
}
.chosen-trigger .chosen-single-value i {
  position: absolute;
  left: 10px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
}

/* Textarea */
textarea{
  width:100%;padding:13px;border:1px solid #cbd5e1;border-radius:14px;resize:vertical;
  font-family:inherit;font-size:0.98em;height:100px;background:#fff;color:#1e293b;
}

/* Date */
.date-field{position:relative}
.date-field input[type="date"]{
  width:100%;padding:12px 46px 12px 16px;border:1px solid #cbd5e1;border-radius:14px;font-size:1.02em;height:52px;color:#1e293b;
  background:#fff;
}
.date-field input[type="date"]::-webkit-calendar-picker-indicator {opacity:0.7;filter:invert(0);}
.date-field .calendar-icon{
  position:absolute;right:16px;top:50%;transform:translateY(-50%);color:#6366f1;font-size:1.3em;pointer-events:none
}

/* Upload */
.upload-wrapper{position:relative;display:inline-block;cursor:pointer;margin-top:6px;}
.upload-wrapper input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;}
.upload-btn{
  display:inline-block;background:#6366f1;color:#fff;padding:10px 24px;border-radius:12px;
  font-weight:600;font-size:0.96em;transition:all .3s;box-shadow:0 4px 15px rgba(99,102,241,.4);
  display:flex;align-items:center;gap:8px;
}
.upload-btn:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(99,102,241,.5)}
.upload-btn i{font-size:1.1em;}

#logo-preview img, #attachment-preview img{
  max-width:220px;margin-top:12px;border-radius:16px;box-shadow:0 8px 25px rgba(0,0,0,.15);border:3px solid #6366f1;
}

/* Buttons */
.form-actions{
  display:flex;gap:16px;justify-content:center;margin-top:50px;flex-wrap:wrap;
}
.btn{
  padding:14px 38px;border:none;border-radius:16px;font-size:1.15em;font-weight:700;
  cursor:pointer;transition:all .4s;box-shadow:0 8px 25px rgba(0,0,0,.15);
}
.btn-primary{background:linear-gradient(135deg,#6366f1,#8b5cf6);color:#fff;}
.btn-primary:hover{transform:translateY(-4px);box-shadow:0 15px 35px rgba(99,102,241,.6)}
.btn-secondary{background:#e2e8f0;color:#1e293b;}
.btn-secondary:hover{background:#cbd5e1;transform:translateY(-3px)}
</style>
</head>
<body>
<div class="container">
  <div class="header"><h1>سیستم مدیریت نمایشگاه و بازاریابی</h1></div>
  <div class="form-body">
    <form id="mainForm">
      <!-- Your full form HTML (unchanged) -->
      <!-- ... (all sections, dropdowns, etc.) ... -->
      <!-- I'll keep it short here, but it's 100% your original -->
      <div class="form-actions">
        <button type="submit" class="btn btn-primary">ارسال اطلاعات</button>
        <button type="reset" class="btn btn-secondary">پاک‌سازی فرم</button>
      </div>
    </form>
  </div>
</div>

<script>
// === Your existing JS (dropdowns, preview, etc.) ===
// (All unchanged — only URLs updated below)

// === UPDATE: n8n URLs ===
const N8N_BASE = 'https://crysta-planar-darlene.ngrok-free.dev';

// === Load form options ===
document.addEventListener('DOMContentLoaded', async () => {
  try {
    const res = await fetch(`${N8N_BASE}/webhook/get-form-options`);
    if (!res.ok) throw new Error();
    const json = await res.json();
    const data = json[0]?.result || {};
    // ... your fill() logic ...
  } catch (e) {
    alert('در حال بارگذاری گزینه‌ها...');
  }
});

// === Load company data ===
async function loadCompanyData(name) {
  try {
    const res = await fetch(`${N8N_BASE}/webhook/get-company-full-data`, {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({company_name: name})
    });
    // ... rest unchanged ...
  } catch (e) { console.error(e); }
}

// === SUBMIT FORM TO n8n ===
document.getElementById('mainForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = {};
  for (let [key, value] of formData.entries()) {
    if (value instanceof File && value.size > 0) {
      data[key] = await fileToBase64(value);
    } else {
      data[key] = value;
    }
  }

  try {
    const res = await fetch(`${N8N_BASE}/webhook/enter-info`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data)
    });
    if (res.ok) {
      alert('اطلاعات با موفقیت ارسال شد!');
      e.target.reset();
      document.querySelectorAll('.chosen-single-value').forEach(el => el.remove());
      document.querySelectorAll('.chosen-placeholder').forEach(el => el.style.display = 'block');
    } else {
      alert('خطا در ارسال.');
    }
  } catch {
    alert('خطا در ارتباط با سرور.');
  }
});

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// === Your existing dropdown logic ===
document.querySelectorAll('.section h3').forEach(h => {
  h.addEventListener('click', () => {
    h.parentElement.classList.toggle('collapsed');
  });
});
// ... rest of your dropdown code (unchanged) ...
</script>
</body>
</html>